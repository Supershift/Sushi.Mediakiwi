$(function(){"use strict";$("#fileupload").fileupload({autoUpload:!1}),$("#fileupload").bind("fileuploaddone",function(a,b){if(b.jqXHR.responseText||b.result){var c=$("#fileupload").data("fileupload"),d=b.jqXHR.responseText?jQuery.parseJSON(b.jqXHR.responseText):b.result;c._adjustMaxNumberOfFiles(d.files.length),c._renderDownload(d.files).appendTo($("#fileupload .files")).fadeIn(function(){$(this).show()})}}),$("#fileupload .files a:not([target^=_blank])").live("click",function(a){a.preventDefault(),$('<iframe style="display:none;"></iframe>').prop("src",this.href).appendTo("body")})}),function(a){"use strict";a.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:a(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,sequentialUploads:!1,forceIframeTransport:!1,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,formData:function(a){return a.serializeArray()},add:function(a,b){b.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(a){var b="undefined";return!(a.forceIframeTransport||typeof XMLHttpRequestUpload===b||typeof File===b||a.multipart&&typeof FormData===b)},_getFormData:function(b){var c;return"function"==typeof b.formData?b.formData(b.form):a.isArray(b.formData)?b.formData:b.formData?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(b){var c=0;return a.each(b,function(a,b){c+=b.size||1}),c},_onProgress:function(a,b){if(a.lengthComputable){var c=b.total||this._getTotal(b.files),d=parseInt(a.loaded/a.total*(b.chunkSize||c),10)+(b.uploadedBytes||0);this._loaded+=d-(b.loaded||b.uploadedBytes||0),b.lengthComputable=!0,b.loaded=d,b.total=c,this._trigger("progress",a,b),this._trigger("progressall",a,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&d.upload.addEventListener&&(d.upload.addEventListener("progress",function(a){c._onProgress(a,b)},!1),b.xhr=function(){return d})},_initXHRData:function(b){var c,d=b.files[0];(!b.multipart||b.blob)&&(b.headers=a.extend(b.headers,{"X-File-Name":d.name,"X-File-Type":d.type,"X-File-Size":d.size}),b.blob?b.multipart||(b.contentType="application/octet-stream",b.data=b.blob):(b.contentType=d.type,b.data=d)),b.multipart&&"undefined"!=typeof FormData&&(b.formData instanceof FormData?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(a,b){c.append(b.name,b.value)})),b.blob?c.append(b.paramName,b.blob):a.each(b.files,function(a,d){d instanceof Blob&&c.append(b.paramName,d)}),b.data=c),b.blob=null},_initIframeSettings:function(a){a.dataType="iframe "+(a.dataType||""),a.formData=this._getFormData(a)},_initDataSettings:function(a){this._isXHRUpload(a)?this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)):this._initIframeSettings(a)},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form"))),b.paramName||(b.paramName=b.fileInput.prop("name")||"files[]"),b.url||(b.url=b.form.prop("action")||location.href),b.type=(b.type||b.form.prop("method")||"").toUpperCase(),"POST"!==b.type&&"PUT"!==b.type&&(b.type="POST")},_getAJAXSettings:function(b){var c=a.extend({},this.options,b);return this._initFormSettings(c),this._initDataSettings(c),c},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(b,c,d){var e=a.Deferred(),f=e.promise();return c=c||this.options.context||f,b===!0?e.resolveWith(c,d):b===!1&&e.rejectWith(c,d),f.abort=e.promise,this._enhancePromise(f)},_chunkedUpload:function(b,c){var d,e,f,g,h=this,i=b.files[0],j=i.size,k=b.uploadedBytes=b.uploadedBytes||0,l=b.maxChunkSize||j,m=i.webkitSlice||i.mozSlice||i.slice;return this._isXHRUpload(b)&&m&&(k||j>l)&&!b.data?c?!0:k>=j?(i.error="uploadedBytes",this._getXHRPromise(!1)):(e=Math.ceil((j-k)/l),d=function(c){return c?d(c-=1).pipe(function(){var d=a.extend({},b);return d.blob=m.call(i,k+c*l,k+(c+1)*l),d.chunkSize=d.blob.size,h._initXHRData(d),h._initProgressListener(d),f=(a.ajax(d)||h._getXHRPromise(!1,d.context)).done(function(){d.loaded||h._onProgress(a.Event("progress",{lengthComputable:!0,loaded:d.chunkSize,total:d.chunkSize}),d),b.uploadedBytes=d.uploadedBytes+=d.chunkSize})}):h._getXHRPromise(!0)},g=d(e),g.abort=function(){return f.abort()},this._enhancePromise(g)):!1},_beforeSend:function(a,b){0===this._active&&this._trigger("start"),this._active+=1,this._loaded+=b.uploadedBytes||0,this._total+=this._getTotal(b.files)},_onDone:function(b,c,d,e){this._isXHRUpload(e)||this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:1,total:1}),e),e.result=b,e.textStatus=c,e.jqXHR=d,this._trigger("done",null,e)},_onFail:function(a,b,c,d){d.jqXHR=a,d.textStatus=b,d.errorThrown=c,this._trigger("fail",null,d),d.recalculateProgress&&(this._loaded-=d.loaded||d.uploadedBytes||0,this._total-=d.total||this._getTotal(d.files))},_onAlways:function(a,b,c,d,e){this._active-=1,e.result=a,e.textStatus=b,e.jqXHR=c,e.errorThrown=d,this._trigger("always",null,e),0===this._active&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(b,c){var d,e,f=this,g=f._getAJAXSettings(c),h=function(c,e){return d=d||(c!==!1&&f._trigger("send",b,g)!==!1&&(f._chunkedUpload(g)||a.ajax(g))||f._getXHRPromise(!1,g.context,e)).done(function(a,b,c){f._onDone(a,b,c,g)}).fail(function(a,b,c){f._onFail(a,b,c,g)}).always(function(a,b,c){c&&"string"!=typeof c?f._onAlways(a,b,c,void 0,g):f._onAlways(void 0,b,a,c,g)})};return this._beforeSend(b,g),this.options.sequentialUploads?(e=this._sequence=this._sequence.pipe(h,h),e.abort=function(){return d?d.abort():h(!1,[void 0,"abort","abort"])},this._enhancePromise(e)):h()},_onAdd:function(b,c){var d=this,e=!0,f=a.extend({},this.options,c);return f.singleFileUploads&&this._isXHRUpload(f)?(a.each(c.files,function(f,g){var h=a.extend({},c,{files:[g]});return h.submit=function(){return d._onSend(b,h)},e=d._trigger("add",b,h)}),e):c.files.length?(c=a.extend({},c),c.submit=function(){return d._onSend(b,c)},this._trigger("add",b,c)):void 0},_normalizeFile:function(a,b){void 0===b.name&&void 0===b.size&&(b.name=b.fileName,b.size=b.fileSize)},_replaceFileInput:function(b){var c=b.clone(!0);a("<form></form>").append(c)[0].reset(),b.after(c).detach(),this.options.fileInput=this.options.fileInput.map(function(a,d){return d===b[0]?c[0]:d})},_onChange:function(b){var c=b.data.fileupload,d={files:a.each(a.makeArray(b.target.files),c._normalizeFile),fileInput:a(b.target),form:a(b.target.form)};return d.files.length||(d.files=[{name:b.target.value.replace(/^.*\\/,"")}]),d.form.length?d.fileInput.data("blueimp.fileupload.form",d.form):d.form=d.fileInput.data("blueimp.fileupload.form"),c.options.replaceFileInput&&c._replaceFileInput(d.fileInput),c._trigger("change",b,d)===!1||c._onAdd(b,d)===!1?!1:void 0},_onDrop:function(b){var c=b.data.fileupload,d=b.dataTransfer=b.originalEvent.dataTransfer,e={files:a.each(a.makeArray(d&&d.files),c._normalizeFile)};return c._trigger("drop",b,e)===!1||c._onAdd(b,e)===!1?!1:void b.preventDefault()},_onDragOver:function(a){var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer;return b._trigger("dragover",a)===!1?!1:(c&&(c.dropEffect=c.effectAllowed="copy"),void a.preventDefault())},_initEventHandlers:function(){var a=this.options.namespace||this.name;this.options.dropZone.bind("dragover."+a,{fileupload:this},this._onDragOver).bind("drop."+a,{fileupload:this},this._onDrop),this.options.fileInput.bind("change."+a,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var a=this.options.namespace||this.name;this.options.dropZone.unbind("dragover."+a,this._onDragOver).unbind("drop."+a,this._onDrop),this.options.fileInput.unbind("change."+a,this._onChange)},_beforeSetOption:function(a,b){this._destroyEventHandlers()},_afterSetOption:function(b,c){var d=this.options;d.fileInput||(d.fileInput=a()),d.dropZone||(d.dropZone=a()),this._initEventHandlers()},_setOption:function(b,c){var d=-1!==a.inArray(b,this._refreshOptionsList);d&&this._beforeSetOption(b,c),a.Widget.prototype._setOption.call(this,b,c),d&&this._afterSetOption(b,c)},_create:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):b.fileInput||(b.fileInput=a()),b.dropZone||(b.dropZone=a()),this._sequence=this._getXHRPromise(!0),this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),a.Widget.prototype.destroy.call(this)},enable:function(){a.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),a.Widget.prototype.disable.call(this)},add:function(b){b&&!this.options.disabled&&(b.files=a.each(a.makeArray(b.files),this._normalizeFile),this._onAdd(null,b))},send:function(b){return b&&!this.options.disabled&&(b.files=a.each(a.makeArray(b.files),this._normalizeFile),b.files.length)?this._onSend(null,b):this._getXHRPromise(!1,b&&b.context)}})}(jQuery);