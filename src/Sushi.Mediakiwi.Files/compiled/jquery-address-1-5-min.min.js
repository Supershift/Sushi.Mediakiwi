!function(a){a.address=function(){var b,c=function(b){return b=a.extend(a.Event(b),function(){for(var b={},c=a.address.parameterNames(),d=0,e=c.length;d<e;d++)b[c[d]]=a.address.parameter(c[d]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:c,parameters:b,queryString:a.address.queryString()}}.call(a.address)),a(a.address).trigger(b),b},d=function(a){return Array.prototype.slice.call(a)},e=function(){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},f=function(){return a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},g=function(){return M.pushState&&F.state!==b},h=function(){return("/"+N.pathname.replace(new RegExp(F.state),"")+N.search+(i()?"#"+i():"")).replace(Q,"/")},i=function(){var a=N.href.indexOf("#");return-1!=a?m(N.href.substr(a+1),E):""},j=function(){return g()?h():i()},k=function(){return"javascript"},l=function(a){return a=a.toString(),(F.strict&&"/"!=a.substr(0,1)?"/":"")+a},m=function(a,b){return F.crawlable&&b?(""!==a?"!":"")+a:a.replace(/^\!/,"")},n=function(a,b){return parseInt(a.css(b),10)},o=function(){if(!W){var a=j();decodeURI($)!=decodeURI(a)&&(I&&H<7?N.reload():(I&&!S&&F.history&&P(s,50),_old=$,$=a,p(E)))}},p=function(a){var b=c(A);a=c(a?B:C),P(r,10),(b.isDefaultPrevented()||a.isDefaultPrevented())&&q()},q=function(){$=_old,g()?M.popState({},"",F.state.replace(/\/$/,"")+(""===$?"/":$)):(W=D,J?F.history?N.hash="#"+m($,D):N.replace("#"+m($,D)):$!=j()&&(F.history?N.hash="#"+m($,D):N.replace("#"+m($,D))),I&&!S&&F.history&&P(s,50),J?P(function(){W=E},1):W=E)},r=function(){if("null"!==F.tracker&&F.tracker!==x){var c=a.isFunction(F.tracker)?F.tracker:K[F.tracker],d=(N.pathname+N.search+(a.address&&!g()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(c)?c(d):a.isFunction(K.urchinTracker)?K.urchinTracker(d):K.pageTracker!==b&&a.isFunction(K.pageTracker._trackPageview)?K.pageTracker._trackPageview(d):K._gaq!==b&&a.isFunction(K._gaq.push)&&K._gaq.push(["_trackPageview",decodeURI(d)])}},s=function(){var a=k()+":"+E+";document.open();document.writeln('<html><head><title>"+L.title.replace(/\'/g,"\\'")+"</title><script>var "+y+' = "'+encodeURIComponent(j()).replace(/\'/g,"\\'")+(L.domain!=N.hostname?'";document.domain="'+L.domain:"")+"\";<\/script></head></html>');document.close();";H<7?R.src=a:R.contentWindow.location.replace(a)},t=function(){if(T&&-1!=U){var a,b,c=T.substr(U+1).split("&");for(a=0;a<c.length;a++)b=c[a].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(b[0])&&(F[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):0!==parseInt(b[1],10)),/^(state|tracker)$/.test(b[0])&&(F[b[0]]=b[1]);T=x}_old=$,$=j()},u=function(){if(!X){X=D,t();var d=function(){v.call(this),w.call(this)},e=a("body").ajaxComplete(d);d(),F.wrap&&(a("body > *").wrapAll('<div style="padding:'+(n(e,"marginTop")+n(e,"paddingTop"))+"px "+(n(e,"marginRight")+n(e,"paddingRight"))+"px "+(n(e,"marginBottom")+n(e,"paddingBottom"))+"px "+(n(e,"marginLeft")+n(e,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+y+'" style="height:100%;overflow:auto;position:relative;'+(J&&!window.statusbar.visible?"resize:both;":"")+'" />'),a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),J&&a('<style type="text/css" />').appendTo("head").text("#"+y+"::-webkit-resizer { background-color: #fff; }")),I&&!S&&(d=L.getElementsByTagName("frameset")[0],R=L.createElement((d?"":"i")+"frame"),R.src=k()+":"+E,d?(d.insertAdjacentElement("beforeEnd",R),d[d.cols?"cols":"rows"]+=",0",R.noResize=D,R.frameBorder=R.frameSpacing=0):(R.style.display="none",R.style.width=R.style.height=0,R.tabIndex=-1,L.body.insertAdjacentElement("afterBegin",R)),P(function(){a(R).bind("load",function(){var a=R.contentWindow;_old=$,($=a[y]!==b?a[y]:"")!=j()&&(p(E),N.hash=m($,D))}),R.contentWindow[y]===b&&s()},50)),P(function(){c("init"),p(E)},1),g()||(I&&H>7||!I&&S?K.addEventListener?K.addEventListener(z,o,E):K.attachEvent&&K.attachEvent("on"+z,o):O(o,50)),"state"in window.history&&a(window).trigger("popstate")}},v=function(){var b,c=a("a"),d=c.size(),e=-1,f=function(){++e!=d&&(b=a(c.get(e)),b.is('[rel*="address:"]')&&b.address('[rel*="address:"]'),P(f,1))};P(f,1)},w=function(){if(F.crawlable){var b=N.pathname.replace(/\/$/,"");-1!=a("body").html().indexOf("_escaped_fragment_")&&a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var c=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(b+"/?$"),"");""!==c&&-1==c.indexOf("_escaped_fragment_")||a(this).attr("href","#"+encodeURI(decodeURIComponent(c.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))))})}},x=null,y="jQueryAddress",z="hashchange",A="change",B="internalChange",C="externalChange",D=!0,E=!1,F={autoUpdate:D,crawlable:E,history:D,strict:D,wrap:E},G=a.browser,H=parseFloat(G.version),I=!a.support.opacity,J=G.webkit||G.safari,K=function(){try{return top.document!==b&&top.document.title!==b?top:window}catch(a){return window}}(),L=K.document,M=K.history,N=K.location,O=setInterval,P=setTimeout,Q=/\/{2,9}/g;G=navigator.userAgent;var R,S="on"+z in K,T=a("script:last").attr("src"),U=T?T.indexOf("?"):-1,V=L.title,W=E,X=E,Y=D,Z=E,$=j();if(_old=$,I){H=parseFloat(G.substr(G.indexOf("MSIE")+4)),L.documentMode&&L.documentMode!=H&&(H=8!=L.documentMode?7:8);var _=L.onpropertychange;L.onpropertychange=function(){_&&_.call(L),L.title!=V&&-1!=L.title.indexOf("#"+j())&&(L.title=V)}}if(M.navigationMode&&(M.navigationMode="compatible"),"complete"==document.readyState)var aa=setInterval(function(){a.address&&(u(),clearInterval(aa))},50);else t(),a(u);return a(window).bind("popstate",function(){decodeURI($)!=decodeURI(j())&&(_old=$,$=j(),p(E))}).bind("unload",function(){K.removeEventListener?K.removeEventListener(z,o,E):K.detachEvent&&K.detachEvent("on"+z,o)}),{bind:function(){return e.apply(this,d(arguments))},unbind:function(){return f.apply(this,d(arguments))},init:function(){return e.apply(this,["init"].concat(d(arguments)))},change:function(){return e.apply(this,[A].concat(d(arguments)))},internalChange:function(){return e.apply(this,[B].concat(d(arguments)))},externalChange:function(){return e.apply(this,[C].concat(d(arguments)))},baseURL:function(){var a=N.href;return-1!=a.indexOf("#")&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==b?(F.autoUpdate=a,this):F.autoUpdate},crawlable:function(a){return a!==b?(F.crawlable=a,this):F.crawlable},history:function(a){return a!==b?(F.history=a,this):F.history},state:function(a){if(a!==b){F.state=a;var c=h();return F.state!==b&&(M.pushState?"/#/"==c.substr(0,3)&&N.replace(F.state.replace(/^\/$/,"")+c.substr(2)):"/"!=c&&c.replace(/^\/#/,"")!=i()&&P(function(){N.replace(F.state.replace(/^\/$/,"")+"/#"+c)},1)),this}return F.state},strict:function(a){return a!==b?(F.strict=a,this):F.strict},tracker:function(a){return a!==b?(F.tracker=a,this):F.tracker},wrap:function(a){return a!==b?(F.wrap=a,this):F.wrap},update:function(){return Z=D,this.value($),Z=E,this},title:function(a){return a!==b?(P(function(){V=L.title=a,Y&&R&&R.contentWindow&&R.contentWindow.document&&(R.contentWindow.document.title=a,Y=E)},50),this):L.title},value:function(a){if(a!==b){if(a=l(a),"/"==a&&(a=""),$==a&&!Z)return;return _old=$,$=a,(F.autoUpdate||Z)&&(p(D),g()?M[F.history?"pushState":"replaceState"]({},"",F.state.replace(/\/$/,"")+(""===$?"/":$)):(W=D,J?F.history?N.hash="#"+m($,D):N.replace("#"+m($,D)):$!=j()&&(F.history?N.hash="#"+m($,D):N.replace("#"+m($,D))),I&&!S&&F.history&&P(s,50),J?P(function(){W=E},1):W=E)),this}return l($)},path:function(a){if(a!==b){var c=this.queryString(),d=this.hash();return this.value(a+(c?"?"+c:"")+(d?"#"+d:"")),this}return l($).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(Q,"/").split("/");return"/"!=a.substr(0,1)&&0!==a.length||b.splice(0,1),"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==b){var c=this.hash();return this.value(this.path()+(a?"?"+a:"")+(c?"#"+c:"")),this}return a=$.split("?"),a.slice(1,a.length).join("?").split("#")[0]},parameter:function(c,d,e){var f,g;if(d!==b){var h=this.parameterNames();for(g=[],d=d===b||d===x?"":d.toString(),f=0;f<h.length;f++){var i=h[f],j=this.parameter(i);"string"==typeof j&&(j=[j]),i==c&&(j=d===x||""===d?[]:e?j.concat([d]):[d]);for(var k=0;k<j.length;k++)g.push(i+"="+j[k])}return-1==a.inArray(c,h)&&d!==x&&""!==d&&g.push(c+"="+d),this.queryString(g.join("&")),this}if(d=this.queryString()){for(e=[],g=d.split("&"),f=0;f<g.length;f++)d=g[f].split("="),d[0]==c&&e.push(d.slice(1).join("="));if(0!==e.length)return 1!=e.length?e:e[0]}},parameterNames:function(){var b=this.queryString(),c=[];if(b&&-1!=b.indexOf("=")){b=b.split("&");for(var d=0;d<b.length;d++){var e=b[d].split("=")[0];-1==a.inArray(e,c)&&c.push(e)}}return c},hash:function(a){return a!==b?(this.value($.split("#")[0]+(a?"#"+a:"")),this):(a=$.split("#"),a.slice(1,a.length).join("#"))}}}(),a.fn.address=function(b){var c;return"string"==typeof b&&(c=b,b=void 0),a(this).attr("address")||a(c||this).live("click",function(c){if(c.shiftKey||c.ctrlKey||c.metaKey||2==c.which)return!0;a(this).is("a")&&(c.preventDefault(),c=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:void 0===a.address.state()||/^\/?$/.test(a.address.state())?a(this).attr("href").replace(/^(#\!?|\.)/,""):a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""),a.address.value(c))}).live("submit",function(c){a(this).is("form")&&(c.preventDefault(),c=a(this).attr("action"),c=b?b.call(this):(-1!=c.indexOf("?")?c.replace(/&$/,""):c+"?")+a(this).serialize(),a.address.value(c))}).attr("address",!0),this}}(jQuery);