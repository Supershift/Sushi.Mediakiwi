window.Slip=function(){"use strict";function a(b,c){if("string"==typeof b&&(b=document.querySelector(b)),!b||!b.addEventListener)throw new Error("Please specify DOM node to attach to");if(!this||this===window)return new a(b,c);this.options=c=c||{},this.options.keepSwipingPercent=c.keepSwipingPercent||0,this.options.minimumSwipeVelocity=c.minimumSwipeVelocity||1,this.options.minimumSwipeTime=c.minimumSwipeTime||110,this.cancel=this.setState.bind(this,this.states.idle),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onSelection=this.onSelection.bind(this),this.setState(this.states.idle),this.attach(b)}function b(a){var b=a.style[i];if(b)return{value:b,original:b};if(window.getComputedStyle){var c=window.getComputedStyle(a).getPropertyValue(j);if(c&&"none"!==c)return{value:c,original:""}}return{value:"",original:""}}function c(a,b){for(var c=0,d=0,e=0;e<b.length;e++)1===b[e].nodeType&&(d++,b[e]===a.node&&(c=d-1));return c}var d=/Chrome\/[34]/.test(navigator.userAgent),e=d,f=d,g=document.createElement("div"),h="webkitTransition"in g.style?"webkitTransition":"transition",i="webkitTransform"in g.style?"webkitTransform":"transform",j="webkitTransform"===i?"-webkit-transform":"transform",k="webkitUserSelect"in g.style?"webkitUserSelect":"userSelect";g.style[i]="translateZ(0)";var l=g.style[i]?"translateZ(0) ":"",m=g.style[i]?"translateZ(1px) ":"";g=null;var n=0,o=!1,p=function(){};return a.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function(){return this.target=null,this.usingTouch=!1,this.removeMouseHandlers(),{allowTextSelection:!0}},undecided:function(){if(this.target.height=this.target.node.offsetHeight,this.target.node.style[h]="",this.dispatch(this.target.originalTarget,"beforewait"))var a=setTimeout(function(){var a=this.getAbsoluteMovement();this.canPreventScrolling&&a.x<15&&a.y<25&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300);else this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder);return{leaveState:function(){clearTimeout(a)},onMove:function(){var a=this.getAbsoluteMovement();if(a.x>20&&a.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe",{directionX:a.directionX,directionY:a.directionY}))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}if(a.y>20&&this.setState(this.states.idle),a.x>1.2*a.y)return!1},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var a=this.dispatch(this.target.originalTarget,"tap");return this.setState(this.states.idle),a}}},swipe:function(){function a(){d.className=d.className.replace(/(?:^| )slip-swiping-container/,"")}var b=!1,d=this.container,e=c(this.target,this.container.childNodes);return d.className+=" slip-swiping-container",this.target.height=this.target.node.offsetHeight,{leaveState:function(){b?this.animateSwipe(function(b){if(b.node.style[i]=b.baseTransform.original,b.node.style[h]="",this.dispatch(b.node,"afterswipe"))return a(),!0;this.animateToZero(void 0,b)}.bind(this)):(this.animateToZero(a),this.dispatch(this.target.node,"cancelswipe"))},onMove:function(){var a=this.getTotalMovement();if(Math.abs(a.y)<this.target.height+20)return this.target.node.style[i]="translate("+a.x+"px,0) "+l+this.target.baseTransform.value,!1;this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var a=this.getAbsoluteMovement(),c=a.x/a.time,d=100*Math.abs((this.startPosition.x-this.previousPosition.x)/this.container.clientWidth),f=c>this.options.minimumSwipeVelocity&&a.time>this.options.minimumSwipeTime||this.options.keepSwipingPercent&&d>this.options.keepSwipingPercent;return f&&this.dispatch(this.target.node,"swipe",{direction:a.directionX,originalIndex:e})&&(b=!0),this.setState(this.states.idle),!f}}},reorder:function(){function a(){d&&(clearTimeout(d),d=null);var a=this.getTotalMovement();this.target.node.style[i]="translate(0,"+a.y+"px) "+m+this.target.baseTransform.value;var b=this.target.height;return o.forEach(function(c){var d=0;c.pos<0&&a.y<0&&c.pos>a.y?d=b:c.pos>0&&a.y>0&&c.pos<a.y&&(d=-b),c.node.style[i]=d?"translate(0,"+d+"px) "+l+c.baseTransform.value:c.baseTransform.original}),!1}this.target.height=this.target.node.offsetHeight;for(var d,e=this.container.childNodes,g=c(this.target,e),n=this.target.node.offsetTop+this.target.height/2,o=[],p=0;p<e.length;p++)if(1==e[p].nodeType&&e[p]!==this.target.node){var q=e[p].offsetTop;e[p].style[h]=j+" 0.2s ease-in-out",o.push({node:e[p],baseTransform:b(e[p]),pos:q+(q<n?e[p].offsetHeight:0)-n})}return this.target.node.className+=" slip-reordering",this.target.node.style.zIndex="99999",this.target.node.style[k]="none",f&&(this.container.style.webkitTransformStyle="preserve-3d"),a.call(this),{leaveState:function(){d&&clearTimeout(d),f&&(this.container.style.webkitTransformStyle=""),this.target.node.className=this.target.node.className.replace(/(?:^| )slip-reordering/,""),this.target.node.style[k]="",this.animateToZero(function(a){a.node.style.zIndex=""}),o.forEach(function(a){a.node.style[i]=a.baseTransform.original,a.node.style[h]=""})},onMove:a,onLeave:function(){d&&clearTimeout(d),d=setTimeout(function(){d=null,this.cancel()}.bind(this),700)},onEnd:function(){var a=this.getTotalMovement();if(a.y<0){for(var b=0;b<o.length;b++)if(o[b].pos>a.y){this.dispatch(this.target.node,"reorder",{spliceIndex:b,insertBefore:o[b].node,originalIndex:g});break}}else for(var b=o.length-1;b>=0;b--)if(o[b].pos<a.y){this.dispatch(this.target.node,"reorder",{spliceIndex:b+1,insertBefore:o[b+1]?o[b+1].node:null,originalIndex:g});break}return this.setState(this.states.idle),!1}}}},attach:function(a){n++,this.container&&this.detach(),!o&&e&&(o=!0,document.body.addEventListener("touchstart",p,!1)),this.container=a,this.otherNodes=[],document.addEventListener("selectionchange",this.onSelection,!1),this.container.addEventListener("touchcancel",this.cancel,!1),this.container.addEventListener("touchstart",this.onTouchStart,!1),this.container.addEventListener("touchmove",this.onTouchMove,!1),this.container.addEventListener("touchend",this.onTouchEnd,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel(),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("touchend",this.onTouchEnd,!1),this.container.removeEventListener("touchmove",this.onTouchMove,!1),this.container.removeEventListener("touchstart",this.onTouchStart,!1),this.container.removeEventListener("touchcancel",this.cancel,!1),document.removeEventListener("selectionchange",this.onSelection,!1),!--n&&o&&(o=!1,document.body.removeEventListener("touchstart",p,!1))},setState:function(a){if(this.state){if(this.state.ctor===a)return;this.state.leaveState&&this.state.leaveState.call(this)}var b=this.state,c=a.call(this);this.state===b&&(c.ctor=a,this.state=c)},findTargetNode:function(a){for(;a&&a.parentNode!==this.container;)a=a.parentNode;return a},onSelection:function(a){(a.target===document||this.findTargetNode(a))&&(a.cancelable||a.defaultPrevented?this.state.allowTextSelection||a.preventDefault():this.setState(this.states.idle))},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(a){this.usingTouch||a.target!==document.documentElement&&a.relatedTarget!==document.documentElement||this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(a){!this.usingTouch&&0==a.button&&this.setTarget(a)&&(this.addMouseHandlers(),this.canPreventScrolling=!0,this.startAtPosition({x:a.clientX,y:a.clientY,time:a.timeStamp}))},onTouchStart:function(a){if(this.usingTouch=!0,this.canPreventScrolling=!0,a.touches.length>1)return void this.setState(this.states.idle);this.setTarget(a)&&this.startAtPosition({x:a.touches[0].clientX,y:a.touches[0].clientY-window.scrollY,time:a.timeStamp})},setTarget:function(a){var c=this.findTargetNode(a.target);if(!c)return this.setState(this.states.idle),!1;for(var d=c.parentNode;d&&!(d.scrollHeight>d.clientHeight&&"visible"!=window.getComputedStyle(d)["overflow-y"]);)d=d.parentNode;return this.target={originalTarget:a.target,node:c,scrollContainer:d,baseTransform:b(c)},!0},startAtPosition:function(a){this.startPosition=this.previousPosition=this.latestPosition=a,this.setState(this.states.undecided)},updatePosition:function(a,b){if(null!=this.target){this.latestPosition=b;var c=40,d=0,e=this.target.scrollContainer||document.body,f=e.getBoundingClientRect(),g=this.target.node.getBoundingClientRect(),h=Math.min(f.bottom,window.innerHeight)-g.bottom,i=g.top-Math.max(f.top,0);h<c?d=c-h:i<c&&(d=i-c);var j=e.scrollTop;e.scrollTop+=d,j!=e.scrollTop&&(this.startPosition.y+=j-e.scrollTop),this.state.onMove&&!1===this.state.onMove.call(this)&&a.preventDefault(),this.latestPosition.time-this.previousPosition.time>100&&(this.previousPosition=this.latestPosition)}},onMouseMove:function(a){this.updatePosition(a,{x:a.clientX,y:a.clientY,time:a.timeStamp})},onTouchMove:function(a){this.updatePosition(a,{x:a.touches[0].clientX,y:a.touches[0].clientY-window.scrollY,time:a.timeStamp}),this.canPreventScrolling=!1},onMouseUp:function(a){this.usingTouch||0!==a.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},onTouchEnd:function(a){a.touches.length>1?this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}},getAbsoluteMovement:function(){return{x:Math.abs(this.latestPosition.x-this.startPosition.x),y:Math.abs(this.latestPosition.y-this.startPosition.y),time:this.latestPosition.time-this.startPosition.time,directionX:this.latestPosition.x-this.startPosition.x<0?"left":"right",directionY:this.latestPosition.y-this.startPosition.y<0?"up":"down"}},dispatch:function(a,b,c){var d=document.createEvent("CustomEvent");return d&&d.initCustomEvent?d.initCustomEvent("slip:"+b,!0,!0,c):(d=document.createEvent("Event"),d.initEvent("slip:"+b,!0,!0),d.detail=c),a.dispatchEvent(d)},getSiblings:function(a){for(var c=[],d=a.node.nextSibling;d;)1==d.nodeType&&c.push({node:d,baseTransform:b(d)}),d=d.nextSibling;return c},animateToZero:function(a,b){b=b||this.target,b.node.style[h]=j+" 0.1s ease-out",b.node.style[i]="translate(0,0) "+l+b.baseTransform.value,setTimeout(function(){b.node.style[h]="",b.node.style[i]=b.baseTransform.original,a&&a.call(this,b)}.bind(this),101)},animateSwipe:function(a){var b=this.target,c=this.getSiblings(b),d="translate(0,"+this.target.height+"px) "+l+" ";b.node.style[h]="all 0.1s linear",b.node.style[i]=" translate("+(this.getTotalMovement().x>0?"":"-")+"100%,0) "+l+b.baseTransform.value,setTimeout(function(){a.call(this,b)&&(c.forEach(function(a){a.node.style[h]="",a.node.style[i]=d+a.baseTransform.value}),setTimeout(function(){c.forEach(function(a){a.node.style[h]=j+" 0.1s ease-in-out",a.node.style[i]="translate(0,0) "+l+a.baseTransform.value}),setTimeout(function(){c.forEach(function(a){a.node.style[h]="",a.node.style[i]=a.baseTransform.original})},101)},1))}.bind(this),101)}},"function"==typeof define&&define.amd&&define(function(){return a}),a}();